#  Copyright 2025 CNM Ingenuity, Inc.
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.
name: YAML-to-Brightspace

description: "Convert from content in YAML input files to Brightspace resource definitions in XML."

inputs:

  checklist-yaml-files:
    description: "One or more file path specifications for input checklist YAML files; may contain wildcards."
    default: "checklists/*.yaml checklists/*.yml"
  
  output-directory: 
    description: "Target subdirectory (in GitHub workspace directory) for output XML resources."
    required: false
    default: converted
  
runs:

  using: composite

  steps:
  
    - name: Setup Java
        uses: actions/setup-java@v5
        with:
          distribution: temurin
          java-version: 21
          
    - name: Create output directory
      run: "mkdir -p ${{ github.workspace }}/${{ inputs.output-directory }}"
      shell: bash

    - name: Convert YAML to Brightspace resources
      run: "chmod +x ${{ github.action_path }}/bin/yaml2brightspace && ${{ github.action_path }}/bin/yaml2brightspace ${{ github.workspace }}/${{ inputs.checklist-yaml-files }} --output-dir ${{ github.workspace }}/${{ inputs.output-directory }}"
      shell: bash

    - name: Copy manifest
      run: "cp ${{ github.action_path }}/manifest/* ${{ github.workspace }}/${{ inputs.output-directory }}"
      shell: bash
